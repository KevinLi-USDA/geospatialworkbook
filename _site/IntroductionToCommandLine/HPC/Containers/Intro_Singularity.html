<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Useful Programs and Unix Basics - Geospatial Workbook</title>
<meta name="description" content="Tutorial on Informatics for Geospatial Information">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Geospatial Workbook">
<meta property="og:title" content="Useful Programs and Unix Basics">
<meta property="og:url" content="http://localhost:4000/IntroductionToCommandLine/HPC/Containers/Intro_Singularity.html">




  <meta property="og:image" content="http://localhost:4000/assets/images/margaret-weir-GZyjbLNOaFg-unsplash_dark.jpg">



  <meta name="twitter:site" content="@isugif">
  <meta name="twitter:title" content="Useful Programs and Unix Basics">
  <meta name="twitter:description" content="Tutorial on Informatics for Geospatial Information">
  <meta name="twitter:url" content="http://localhost:4000/IntroductionToCommandLine/HPC/Containers/Intro_Singularity.html">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/margaret-weir-GZyjbLNOaFg-unsplash_dark.jpg">
  

  







  

  


<link rel="canonical" href="http://localhost:4000/IntroductionToCommandLine/HPC/Containers/Intro_Singularity.html">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Geospatial Workbook Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E6BZVYF8ZY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E6BZVYF8ZY');
</script>

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Geospatial Workbook</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/about.html" >About</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/list.html" >Index</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/glossary.html" >Glossary</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/people.html" >People</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/contributing.html" >Contribute</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero--overlay"
  style="background-color: 444444; background-image: url('/assets/images/margaret-weir-GZyjbLNOaFg-unsplash_dark.jpg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          Useful Programs and Unix Basics

        
      </h1>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Useful Programs and Unix Basics">
    
    
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
        <h1 id="introduction-to-singularity-containers">Introduction to Singularity Containers</h1>

<h2 id="what-are-containers">What are Containers?</h2>

<p>A container can be thought of as a light weight Virtual machine that are in itself a portable linux environment.  They help with reproducibility and dependencies required to run a script, program or pipeline.</p>

<h2 id="initial-setup">Initial setup</h2>

<p>In order to use the container you will need to load the Singularity module on your HPC resource or install it on your local machine. This will vary from HPC resource to HPC resource.  You can find what your HPC called the module by using the <code class="language-plaintext highlighter-rouge">module avail</code> command.  In many cases it will be as simple as the command below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load singularity
</code></pre></div></div>

<h2 id="finding-and-downloading-a-singularity-container">Finding and Downloading a Singularity Container</h2>

<p>There are two main places that you can find containers that will work with singularity.</p>

<ul>
  <li>https://singularity-hub.org/</li>
  <li>https://hub.docker.com</li>
</ul>

<p>The first time you use singularity it will by default put a .singularity folder in your home directory which commonly has limited storage space.  Therefore it is important that you move that folder to a different location and then create a softlink from your home directory to the new location.</p>

<h4 id="example-from-docker-shub">Example from Docker shub.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>singularity pull docker://sjackman/maker
singularity exec --bind $PWD ./maker.img maker --help
</code></pre></div></div>

<h4 id="example-from-singularity-hub">Example from Singularity Hub</h4>

<p>First go to <a href="https://www.singularity-hub.org/">Singularity Hub</a> and locate the container you want through the search box located on the left side just below the <code class="language-plaintext highlighter-rouge">ADD A COLLECTION</code> button and above the list of containers.</p>

<p><img src="/IntroductionToCommandLine/HPC/Containers/assets/SingularityHubcollectionsPage.png" alt="" /></p>

<p>For this example searched for ISUGIF and will download one called utilities. First you click on the utilities part of the link which will bring you to a page that looks like this:</p>

<p><img src="/IntroductionToCommandLine/HPC/Containers/assets/singularity_utilities.png" alt="" /></p>

<p>The uri is the important bit of information you will need to download this image using the singularity pull command. Unfortunately, there is no easy way to copy this so I typically just copy the header and then manually type in the container name (:utilities.1.0.0) in the command below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>singularity pull shub://ISUGIFsingularity/utilities:1.0.1
</code></pre></div></div>
<p>If you get a <strong>CERTIFICATE_VERIFY_FAILED:</strong> error then you can set your python certificate verification to off.
<code class="language-plaintext highlighter-rouge">export PYTHONHTTPSVERIFY=0</code></p>

<h4 id="direct-execution-of-singularity-containers">Direct execution of Singularity containers</h4>
<p>Containers often have runscripts that will provide you with useful information on how to use the container. The run scripts get initiated by executing the image as follows:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./ISUGIFsingularity-utilities-master-1.0.1.simg
</code></pre></div></div>
<p>Which in this case produces a list of files that can be called by the image.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colsum  createhist.awk  intervalBins.awk  nb  nbsearch  new_Assemblathon.pl  readme  README.md  seqlen.awk  summary.sh
</code></pre></div></div>

<p>As I mentioned above, these are useful scripts often used in our group.  One script borrowed from the Assemblathon paper, new_Assemblathon.pl, we use when evaluating genome assemblies and want to get a summary of the assembly statistics.  To use this script via the container we can execute it in the following manner.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>singularity exec ISUGIFsingularity-utilities-master-1.0.1.simg new_Assemblathon.pl Spirochaete.fasta
</code></pre></div></div>

<p>This way of executing containers is kind of tedious as it requires so much more than just the new_Assemblathon.pl script that you could just download and place it somewhere in your path.  Later in this tutorial, we will show you how to create a bash script wrapper that will simplify calling the function from within the container.  In most cases creating a container for a simple script (perl, python, bash) doesn’t make sense as it creates a small overhead to load singularity and the container before executing the script.  Where containers shine, is when your script or pipeline requires lots and lots of software prerequisites (for example: a specific version of perl, blast, qiime, samtools, etc)</p>

<p>We ran the new_Assemblathon.pl script from the container on a spirochaete genome we had handy and it produced the desired output.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---------------- Information for assembly '/Users/severin/Downloads/Spirochaete.fasta' ----------------


                                         Number of scaffolds          1
                                     Total size of scaffolds    3251735
                                            Longest scaffold    3251735
                                           Shortest scaffold    3251735
                                 Number of scaffolds &gt; 1K nt          1 100.0%
                                Number of scaffolds &gt; 10K nt          1 100.0%
                               Number of scaffolds &gt; 100K nt          1 100.0%
                                 Number of scaffolds &gt; 1M nt          1 100.0%
                                Number of scaffolds &gt; 10M nt          0   0.0%
                                          Mean scaffold size    3251735
                                        Median scaffold size    3251735
                                         N50 scaffold length    3251735
                                          L50 scaffold count          1
                                                 scaffold %A      25.62
                                                 scaffold %C      24.57
                                                 scaffold %G      24.21
                                                 scaffold %T      25.60
                                                 scaffold %N       0.00
                                         scaffold %non-ACGTN       0.00
                             Number of scaffold non-ACGTN nt          0
...
This output has been truncated
</code></pre></div></div>

<h2 id="how-to-install-and-use-singularity-on-your-locall-machine-mac">How to install and use Singularity on your locall machine (Mac)</h2>
<p>If you want to explore containers on your local Mac you canfFollow the directions on this website <a href="http://singularity.lbl.gov/install-mac">http://singularity.lbl.gov/install-mac</a></p>

<p>Note: You may need to issue the following command if you update your operating system or get a new computer.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Note you may need to allow Oracle permission via your security settings if you are on a mac.  See [this website](https://apple.stackexchange.com/questions/301303/virtualbox-5-1-28-fails-to-install-on-macos-10-13-due-to-kext-security)
</code></pre></div></div>

<h4 id="starting-a-singularity-virtual-machine-vm-instance-on-the-mac">Starting a singularity Virtual Machine (VM) instance on the Mac</h4>

<p>If you are using your local machine, this will allow you to not only execute containers but also build containers from recipes and test them out.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir singularity-vm
cd singularity-vm
vagrant destroy
vagrant init singularityware/singularity-2.4
vagrant up
vagrant ssh
</code></pre></div></div>

<h4 id="running-a-command-using-a-singularity-container--same-as-above">Running a command using a Singularity container.  (Same as above)</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>singularity exec ISUGIFsingularity-utilities-master-1.0.1.simg new_Assemblathon.pl Spirochaete.fasta
</code></pre></div></div>

<h4 id="transferring-files-off-and-onto-a-local-vagrant-virtual-machines">transferring files off and onto a local vagrant virtual machines</h4>

<p>You probably started your vm and realized that you can’t access any of your files to try out the command above.
If you are running a VM locally to use singularity, you can transfer files to and from your VM using <code class="language-plaintext highlighter-rouge">scp</code> and the VM private key.</p>

<p>Change into the folder you initiated your vagrant vm <code class="language-plaintext highlighter-rouge">singularity-vm</code> and run the vagrant ssh-config command to get the private key</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant ssh-config
</code></pre></div></div>
<p>OUTPUT</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Host default
  HostName 127.0.0.1
  User vagrant
  Port 2222
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile /Users/severin/singularity-vm/.vagrant/machines/default/virtualbox/private_key
  IdentitiesOnly yes
  LogLevel FATAL
</code></pre></div></div>

<p>Then using that key scp files off of the virtual box from a newly opened terminal that is not in the VM.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp -P 2222 -i /Users/severin/singularity-vm/.vagrant/machines/default/virtualbox/private_key vagrant@127.0.0.1:/home/vagrant/recipe .
</code></pre></div></div>
<p>or transfer a file to the VM.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp -P 2222 -i /Users/severin/singularity-vm/.vagrant/machines/default/virtualbox/private_key  ~/Downloads/Spirochaete.fasta vagrant@127.0.0.1:/home/vagrant/
</code></pre></div></div>

<h4 id="creating-wrappers-for-the-singularity-commands">creating wrappers for the singularity commands</h4>

<p>Here is an example bash script wrapper for a singularity execution of a command in a container.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>new_assemblathon
#!/bin/bash

singularity exec ISUGIFsingularity-utilities-master.simg new_Assemblathon.pl
</code></pre></div></div>

<p>This wrapper contains the singularity command and once put in your path you can just use</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>new_Assemblathon
</code></pre></div></div>

<p>to execute the script via the singularity container.</p>

<h4 id="to-create-your-own-containers-see-the-next-tutorial">To create your own containers see the next tutorial</h4>

<p><a href="/IntroductionToCommandLine/HPC/Containers/creatingContainers.html">How to create your own Containers</a></p>

<hr />
<p><a href="../../programs.md">Table of contents</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      

    </div>

    
  </article>

  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <input type="search" id="cse-search-input-box-id" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    </form>
    <div id="results" class="results">
        <gcse:searchresults-only></gcse:searchresults-only>
    </div></div>

      </div>
    
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/isugif"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="https://github.com/https://github.com/isugenomics"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Geospatial Workbook</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>


<script>
  (function () {
    var cx = '009853197685285203469:nsvri1pa88d';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
</script>




<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" defer
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>




  </body>
</html>
