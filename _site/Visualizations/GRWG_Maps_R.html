<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Making publication-quality maps in R - Geospatial Workbook</title>
<meta name="description" content="Tutorial on Informatics for Geospatial Information">


  <meta name="author" content="Heather Savoy">


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Geospatial Workbook">
<meta property="og:title" content="Making publication-quality maps in R">
<meta property="og:url" content="http://localhost:4000/Visualizations/GRWG_Maps_R.html">




  <meta property="og:image" content="http://localhost:4000/assets/images/elena-mozhvilo-znhEe1cbbQE-unsplash-1200_800.jpg">



  <meta name="twitter:site" content="@isugif">
  <meta name="twitter:title" content="Making publication-quality maps in R">
  <meta name="twitter:description" content="Tutorial on Informatics for Geospatial Information">
  <meta name="twitter:url" content="http://localhost:4000/Visualizations/GRWG_Maps_R.html">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/elena-mozhvilo-znhEe1cbbQE-unsplash-1200_800.jpg">
  

  
    <meta name="twitter:creator" content="@someone">
  







  

  


<link rel="canonical" href="http://localhost:4000/Visualizations/GRWG_Maps_R.html">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Geospatial Workbook Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E6BZVYF8ZY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E6BZVYF8ZY');
</script>

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Geospatial Workbook</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/about.html" >About</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/list.html" >Index</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/glossary.html" >Glossary</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/people.html" >People</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/contributing.html" >Contribute</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero--overlay"
  style="background-color: 444444; background-image: url('/assets/images/elena-mozhvilo-znhEe1cbbQE-unsplash-1200_800.jpg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          Making publication-quality maps in R

        
      </h1>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/people/HeatherSavoy.png" alt="Heather Savoy" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Heather Savoy</h3>
    
    
      <p class="author__bio" itemprop="description">
        Heather is a Computational Biologist (Data Scientist) in the USDA-ARS SCINet Office. Her research interests include applying informatics methods to multidisciplinary agro-ecosystem problems and building data science software tools for geospatial research. She received her Ph.D. in Civil and Environmental Engineering with an emphasis in Computational Data Science and Engineering from the University of California Berkeley. She also holds a B.S. in Environmental Science with a minor in Computational Mathematics from the Florida Institute of Technology.
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      
        <li>
          <a href="mailto:mailto:heather.savoy@usda.gov">
            <meta itemprop="email" content="mailto:heather.savoy@usda.gov" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/someone" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

<!-- Create a 2nd author for tutorials -->



<div itemscope itemtype="http://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Making publication-quality maps in R">
    
    
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
        <p><strong>Last Update:</strong> 17 September 2023 <br /> <strong>Download RMarkdown</strong>:
<a href="https://geospatial.101workbook.org/tutorials/GRWG_Maps.Rmd">GRWG_Maps.Rmd</a></p>

<h2 id="overview">Overview</h2>

<p>This tutorial covers creating maps in R using the <code class="language-plaintext highlighter-rouge">sf</code> and <code class="language-plaintext highlighter-rouge">ggplot2</code>
packages.</p>

<p>To download the Rmarkdown file for this tutorial to your local machine
(or any SCINet cluster within OoD), you can use the following lines:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(httr)
tutorial_name &lt;- 'GRWG_Maps.Rmd'
GET(paste0('https://geospatial.101workbook.org/tutorials/',tutorial_name), 
    write_disk(tutorial_name))
</code></pre></div></div>

<p><em>Language:</em> <code class="language-plaintext highlighter-rouge">R</code></p>

<p><em>Primary Libraries/Packages:</em></p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Name</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">Link</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">sf</td>
      <td style="text-align: left">Simple Features for R</td>
      <td style="text-align: left">https://r-spatial.github.io/sf/</td>
    </tr>
    <tr>
      <td style="text-align: left">ggplot2</td>
      <td style="text-align: left">Create Elegant Data Visualizations Using the Grammar of Graphics</td>
      <td style="text-align: left">https://ggplot2.tidyverse.org/</td>
    </tr>
  </tbody>
</table>

<h2 id="nomenclature">Nomenclature</h2>

<ul>
  <li><em>Raster:</em> Data defined on a grid of geospatial coordinates</li>
  <li><em>CRS:</em> Coordinate Reference System, also known as a spatial
reference system. A system for defining geospatial coordinates.</li>
</ul>

<h2 id="data-details">Data Details</h2>

<ul>
  <li>Data: FS National Forests Dataset (US Forest Service Proclaimed Forests)</li>
  <li>Link: <a href="https://www.geoplatform.gov/metadata/bd04f8d8-96cc-5eac-96af-566bea975ba3">https://www.geoplatform.gov/metadata/bd04f8d8-96cc-5eac-96af-566bea975ba3</a></li>
  <li>
    <p>Other Details: The FS National Forests Dataset (US Forest Service Proclaimed 
Forests) is a depiction of the boundaries encompassing the National Forest 
System (NFS) lands.</p>
  </li>
  <li>Data: 3DEP Bare Earth Digital Elevation Model</li>
  <li>Link <a href="https://www.usgs.gov/3d-elevation-program">https://www.usgs.gov/3d-elevation-program</a></li>
  <li>Other Details: To respond to growing needs for high-quality elevation data, 
the goal of 3DEP is to complete acquisition of nationwide lidar (IfSAR in AK) 
to provide the first-ever national baseline of consistent high-resolution 
topographic elevation data – both bare earth and 3D point clouds.</li>
</ul>

<h2 id="steps">Steps</h2>

<ul>
  <li>Acquire data:
    <ul>
      <li>Access informational boundaries</li>
      <li>Define study area and points</li>
      <li>Download raster to fill study area</li>
    </ul>
  </li>
  <li>Incrementally plot:
    <ul>
      <li>Map background</li>
      <li>Raster</li>
      <li>Study area</li>
      <li>Points</li>
      <li>Annotations</li>
    </ul>
  </li>
  <li>Format legends, axes, and map scale</li>
</ul>

<h2 id="step-0-import-librariespackages">Step 0: Import Libraries/Packages</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library(httr)           # Access data from online resources
library(sf)             # Handle vector data
library(terra)          # Handle raster data
library(USAboundaries)  # US boundaries vector data
library(dplyr)          # General data manipulation
library(ggplot2)        # Visualizations
library(ggspatial)      # Extra geospatial annotations for maps
</code></pre></div></div>

<h2 id="step-1-acquire-data">Step 1: Acquire data</h2>

<p>We can use the <code class="language-plaintext highlighter-rouge">us_states()</code> function from the <code class="language-plaintext highlighter-rouge">USABoundaries</code> packages
to easily define a study area based on states. This function returns a
<code class="language-plaintext highlighter-rouge">sf</code> object. For <code class="language-plaintext highlighter-rouge">sf</code> objects, there is a default plotting method that
can be used.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Pull the boundaries for some select states for our study area
my_area &lt;- us_states(states = c('LA','MS','AL','GA','FL'))

# Save the bounding box for later use
my_bbox &lt;- my_area %&gt;%
  st_bbox()

# Plot using the default plotting method for `sf` objects
plot(my_area['name'])
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_study_area_sf_plot-1.png" alt="" /></p>

<p>But we will use the <code class="language-plaintext highlighter-rouge">ggplot2</code> functions to build more complicated maps.
With both the <code class="language-plaintext highlighter-rouge">ggplot2</code> and <code class="language-plaintext highlighter-rouge">sf</code> packages, we can take advantage of the
<code class="language-plaintext highlighter-rouge">geom_sf()</code> function to quickly plot <code class="language-plaintext highlighter-rouge">sf</code> objects in the <code class="language-plaintext highlighter-rouge">ggplot2</code>
framework. Unlike most <code class="language-plaintext highlighter-rouge">ggplot()</code> uses, you don’t have to specify the
<code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> mapping aesthetic for <code class="language-plaintext highlighter-rouge">geom_sf()</code> since that will be assumed
from the geometry column.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ggplot() +
  geom_sf(data=my_area)
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_study_area_4326-1.png" alt="" /></p>

<p>Say you want to use a certain CRS in the project for which you are
making your map. This can affect the plotted map.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Specify the target CRS
target_crs &lt;- 5070
target_crs_str &lt;- paste0('EPSG:',target_crs)

# Transform area to that CRS and save the bounding box in the CRS for later use
my_area_tcrs &lt;- my_area %&gt;%
  st_transform(target_crs)
my_bbox_tcrs &lt;- my_area_tcrs %&gt;%
  st_bbox()

# Plot the transformed area
ggplot() +
  geom_sf(data=my_area_tcrs) 
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_study_area_5070-1.png" alt="" /></p>

<p>The plot coordinate system depends on the order of the <code class="language-plaintext highlighter-rouge">geom_sf()</code>
calls, or what’s specifically stated in <code class="language-plaintext highlighter-rouge">coord_sf()</code>.</p>

<p>Let’s now consider another vector dataset we’d like to plot within our
study area. We can use the GeoPlatform API to download a subset of the
<em>FS National Forests Dataset (US Forest Service Proclaimed Forests)</em>
dataset from the US Forest Service.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># GeoPlatform API url
api_url &lt;- 'https://geoapi.geoplatform.gov'

# Read collections catalog
collections_url &lt;- paste0(api_url,'/collections')
collections_content &lt;- GET(collections_url) %&gt;%
  content() 
collections_md &lt;- collections_content$collections

# Get collection ID for collection with 'forest' in the title
search_term &lt;- 'forest'
collection_titles &lt;- sapply(collections_md, function(col) tolower(col$title))
collection_id &lt;- collections_md[[grep(search_term,collection_titles)]]$id

# Download data within bounding box from collection 
bbox_str &lt;- paste0(my_bbox,collapse = ',')
data_url &lt;- paste0(collections_url, "/" ,collection_id,
                  "/items?limit=10000&amp;bbox=", bbox_str)
tmp_file &lt;- 'temp.zip'
GET(data_url, write_disk(tmp_file,overwrite=TRUE))

collection_sf &lt;- st_read(tmp_file)

# View shape
ggplot() +
  geom_sf(data=collection_sf)
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_forests-1.png" alt="" /></p>

<p>Now let’s plot both this forest dataset and our study area.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ggplot() +
  geom_sf(data=my_area_tcrs) +
  geom_sf(data=collection_sf)
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_forest_study_area-1.png" alt="" /></p>

<p>First, it is hard to distinguish the two vector datasets with the
default coloring. Second, we requested forests within a bounding box of
our study area. So let’s find the intersection of our forests and study
area, and color the forests polygons.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>my_forests_tcrs &lt;- collection_sf %&gt;%
  st_transform(target_crs) %&gt;%
  st_buffer(1) %&gt;%
  st_intersection(my_area_tcrs)

ggplot() +
  geom_sf(data=my_area_tcrs) +
  geom_sf(data=my_forests_tcrs,
          fill = 'forestgreen')
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_forests_study_area_clear-1.png" alt="" /></p>

<p>And let’s also get a raster dataset to fill in our study area. We will
download some elevation from The National Map. Again, we will use our
study area bounding box to define our subset.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tnm_url &lt;- 'https://elevation.nationalmap.gov/arcgis/rest/services/'
my_raster &lt;- 'elev.tiff'
GET(paste0(tnm_url,'3DEPElevation/ImageServer/exportImage?bbox=',bbox_str,
           '&amp;bboxSR=4326&amp;format=tiff&amp;f=image'), 
    write_disk(my_raster,overwrite=TRUE))

elev &lt;- rast(my_raster) 

# Visualize with default terra plotting function for rasters
plot(elev)
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_elev-1.png" alt="" /></p>

<p>We will reproject this raster into our target CRS and apply a mask
defined by our study area. Then, we will also convert this <code class="language-plaintext highlighter-rouge">terra</code>
object into a <code class="language-plaintext highlighter-rouge">data.frame</code> to help with our <code class="language-plaintext highlighter-rouge">ggplot</code>ting.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elev_masked &lt;- elev %&gt;%
  project(target_crs_str) %&gt;%
  mask(my_area_tcrs)

elev_df &lt;- elev_masked %&gt;%
  as.data.frame(xy=TRUE)
</code></pre></div></div>

<p>With the default color scale, the elevation is difficult to distinguish
across the study area.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elev_df %&gt;%
  ggplot(aes(x,y,fill=elev)) +
  geom_raster()
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_raster-1.png" alt="" /></p>

<p>There is an option to apply transformations within the fill color scale,
<code class="language-plaintext highlighter-rouge">scale_fill_continuous</code>, e.g., the square-root transform which can
increase the visual contrast in the elevation raster. However, there are
areas below sea level in our study area so these pixels will become <code class="language-plaintext highlighter-rouge">NA</code>
after the square-root transform.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elev_df %&gt;%
  ggplot(aes(x,y,fill=elev)) +
  geom_raster() +
  scale_fill_continuous(trans = 'sqrt')

#&gt; Warning in self$trans$transform(x): NaNs produced

#&gt; Warning: Transformation introduced infinite values in discrete y-axis
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_raster_bad_transform-1.png" alt="" /></p>

<p>You can also manually modify your raster variable being plotted to
perform similar transformations, including more flexibility like an
offset for our case to deal with the below sea level values. The
down-side is you would also have to manually edit the legend to make it
more interpretable.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elev_df %&gt;%
  ggplot(aes(x,y,fill=sqrt(elev+50))) +
  geom_raster()
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_raster_manual_transform-1.png" alt="" /></p>

<p>Another option is to break up your fill color scale into bins. One
option for binning continous values in <code class="language-plaintext highlighter-rouge">ggplot2</code> is the
<code class="language-plaintext highlighter-rouge">scale_*_fermenter</code> function that relies on the <code class="language-plaintext highlighter-rouge">RColorBrewer</code> package.
Here, we will use this option and set manual breaks in our elevation.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ggplot() +
  geom_raster(aes(x,y,fill=elev),
              data = elev_df) +
  scale_fill_fermenter(palette = 'BrBG',
                       name = 'Elevation',
                       breaks = c(-50,0,50,250,500,750))
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_raster_binned-1.png" alt="" /></p>

<p>So here is the current state of our map with the elevation raster and
the study area and forest polygons:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ggplot() +
  geom_raster(aes(x,y,fill=elev),
              data = elev_df) +
  geom_sf(data=my_area_tcrs,
          fill = NA) +
  geom_sf(data=my_forests_tcrs,
          fill = 'red') +
  scale_fill_fermenter(palette = 'BrBG',
                       name = 'Elevation',
                       breaks = c(-50,0,50,250,500,750))
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_raster_with_vector-1.png" alt="" /></p>

<p>Now, we can add some nice map background layers and annotations. First,
let’s build a background to show the context of neighboring states and
water. We use the <code class="language-plaintext highlighter-rouge">USABoundaries</code> package again to create a US states
background and fill those states with a light green color (<code class="language-plaintext highlighter-rouge">#e3f7dc</code>).
We also set the panel background fill color with a light blue
(<code class="language-plaintext highlighter-rouge">#afdbed</code>) since this represents the water areas in the map.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>all_states &lt;- us_states() %&gt;%
  st_transform(target_crs_str)

ggplot() +
 geom_sf(data = all_states,  #base color for all land
            fill = "#e3f7dc",
            col = "gray75",
            linewidth = 0.15) +
  geom_sf(data=my_area_tcrs,   #our study area states
          fill = NA,
          linewidth = 0.5) +
  scale_x_continuous(name = 'Longitude',   # limit axes to study area bounding box
                     limits = range(my_bbox_tcrs[c(1,3)])) +
  scale_y_continuous(name = 'Latitude',
                     limits = range(my_bbox_tcrs[c(2,4)])) +
  theme(panel.background = element_rect(fill = alpha('#afdbed', 0.5)),  # water!
        panel.grid.major = element_line(color = 'white', linewidth = 0.3)) 
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_background-1.png" alt="" /></p>

<p>Now, let’s combine all of our incremental steps into one plot. We can
also add some annotations like a north arrow, a scale bar, and some
arrows.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Define points between which to draw an arrow
arrow_pts &lt;- data.frame(x = c(-82,-89.25),
                       y = c(29.5, 32.5)) %&gt;%
  st_as_sf(coords = c('x','y'),
           crs = 4326) %&gt;%
  st_transform(target_crs) %&gt;%
  st_coordinates() %&gt;%
  as_tibble()

# Draw the complete map
ggplot() +
 geom_sf(data = all_states,  #base color for all land
            fill = "#e3f7dc",
            col = "gray75",
            linewidth = 0.15) +
  geom_raster(aes(x,y,fill=elev),  # elevation raster
              data = elev_df) +
  geom_sf(data=my_area_tcrs,  # our study area states
          fill = NA,
          linewidth = 0.5) +
  geom_sf(data=my_area_tcrs %&gt;%  # highlight boundary of the study area
            st_union(),
          fill = NA,
          color = 'black',
          linewidth = 0.5) +
  geom_sf(data=my_forests_tcrs, # forest polygons
          fill = 'red',
          alpha = 0.5,
          color = 'firebrick',
          linewidth = 0.25) +
  geom_curve(aes(x=arrow_pts$X[1], y = arrow_pts$Y[1],  # curved arrow
                 xend = arrow_pts$X[2], yend = arrow_pts$Y[2]), 
             curvature = 0.25,
             arrow = arrow(length = unit(2,'mm'), 
                           type = 'closed'),
           color = 'red') +
  scale_fill_fermenter(palette = 'BrBG',
                       name = 'Elevation',
                       breaks = c(-50,0,50,250,500,750)) +
  scale_x_continuous(name = 'Longitude',
                     limits = range(my_bbox_tcrs[c(1,3)])) +
  scale_y_continuous(name = 'Latitude',
                     limits = range(my_bbox_tcrs[c(2,4)])) +
  annotation_scale(location = "tl") +
  annotation_north_arrow(height = unit(1, "cm"),
                         width = unit(1, "cm")) +
  theme(panel.background = element_rect(fill = alpha('#afdbed', 0.5)),
        panel.grid.major = element_line(color = 'white', linewidth = 0.3)) 
</code></pre></div></div>

<p><img src="/Visualizations/assets/R_final-1.png" alt="" /></p>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      

    </div>

    
  </article>

  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form onsubmit="return googleCustomSearchExecute();" id="cse-search-box-form-id">
    <input type="search" id="cse-search-input-box-id" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    </form>
    <div id="results" class="results">
        <gcse:searchresults-only></gcse:searchresults-only>
    </div></div>

      </div>
    
    
    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/isugif"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="https://github.com/https://github.com/isugenomics"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Geospatial Workbook</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>


<script>
  (function () {
    var cx = '009853197685285203469:nsvri1pa88d';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();

  function googleCustomSearchExecute() {
    var input = document.getElementById('cse-search-input-box-id');
    var element = google.search.cse.element.getElement('searchresults-only0');
    if (input.value == '') {
      element.clearAllResults();
    } else {
      element.execute(input.value);
    }
    return false;
  }

  
</script>




<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" defer
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>




  </body>
</html>
